<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="site.zido.mapper.user.SubscriberUserMapper">

	<!-- 通用查询映射结果 -->
	<resultMap id="BaseResultMap" type="site.zido.entity.SubscriberUser">
		<id column="id" property="id" />
		<result column="phone_number" property="phoneNumber" />
		<result column="id_card_front_url" property="idCardFrontUrl" />
		<result column="id_card_behind_url" property="idCardBehindUrl" />
		<result column="id_card" property="idCard" />
		<result column="real_name" property="realName" />
		<result column="avatar" property="avatar" />
		<result column="ali_pay" property="aliPay" />
		<result column="ali_tm" property="aliTm" />
		<result column="wechat" property="wechat" />
		<result column="taobao_star" property="taobaoStar" />
		<result column="sex" property="sex" />
		<result column="birth_day" property="birthDay" />
		<result column="qq" property="qq" />
		<result column="brushed" property="brushed" />
		<result column="recommand_screen_shot_url" property="recommandScreenShotUrl" />
		<result column="star_screen_shot_url" property="starScreenShotUrl" />
		<result column="ali_pay_screen_shot_url" property="aliPayScreenShotUrl" />
		<result column="user_id" property="userId" />
		<result column="state" property="state" />
		<result column="creat_time" property="creatTime" />
		<result column="nickname" property="nickname" />
		<result column="introduce_id" property="introduceId" />
		<result column="career_id" property="careerId" />
		<result column="age" property="age" />

	</resultMap>

	<resultMap id="SubscriberINFO" type="site.zido.dto.SubscriberUserInfoDTO">
		<association columnPrefix="bs_" property="subscriberUser" resultMap="site.zido.mapper.user.SubscriberUserMapper.BaseResultMap"/>
		<association columnPrefix="ca_" property="career" resultMap="site.zido.mapper.user.CareerMapper.BaseResultMap"></association>
	</resultMap>
	
    <!-- 通用查询结果列 -->
    <sql id="Base_Column_List">
        id, phoneNumber, IDCardFrontUrl, IDCardBehindUrl, IDCard, realName, avatar, aliPay, aliTM, wechat, taobaoStar, sex, birthDay, Qq, brushed, recommandScreenShotUrl, starScreenShotUrl, aliPayScreenShotUrl, userId,create_time,nickname
    </sql>

	<select id="selectByKey" resultMap="BaseResultMap">
		select user_id,nickname from brush_business_user where state = #{state} and (real_name like '%${key}%' or nickname like '%${key}%')
		order by ((case when real_name like '%${key}%' then 2 else 0 end) + (case when nickname like '%${key}%' then 1 else 0 end))  DESC ,sort DESC limit #{max}
	</select>

	<!--多条件搜索-->
	<select id="searchSubscriberList" resultMap="SubscriberINFO">
		SELECT

		ca.id AS  ca_id,
		ca.name AS ca_name,

		bs.phone_number AS bs_phone_number,
		bs.state AS bs_state,
		bs.real_name AS bs_real_name,
		bs.nickname AS bs_nickname,
		bs.age AS bs_age,
		bs.birth_day AS bs_birth_day,
		bs.ali_pay AS bs_ali_pay,
		bs.ali_tm AS bs_ali_tm,
		bs.career_id AS bs_career_id,
		bs.creat_time AS bs_creat_time,
		bs.introduce_id AS bs_introduce_id,
		bs.taobao_star AS bs_taobao_star


		FROM brush_user t1
		INNER JOIN brush_subscriber_user bs on t1.id = bs.user_id
		INNER JOIN brush_career ca on ca.id = bs.career_id
		<where>
			<if test="condition.phonenumber != null">
				and bs.phone_number LIKE '%${condition.phonenumber}%'
			</if>
			<if test="condition.stime != null and condition.etime !=null">
				and (bs.creat_time &gt; #{condition.stime} and bs.creat_time &lt; #{condition.etime})
			</if>
			<if test="condition.states != null and condition.states.length &gt; 0">
				<trim prefixOverrides="or" prefix="and (" suffix=" ) ">
					<foreach collection="condition.states" item="state">
						or bs.states = #{state}
					</foreach>
				</trim>
			</if>
		</where>
		<if test="condition.sortName != null ">
			order by ${condition.sortName}
			<choose>
				<when test="condition.DESC == true">
					DESC
				</when>
				<otherwise>
					ASC
				</otherwise>
			</choose>
		</if>
	</select>
	<select id="findSubUserByCondition" resultMap="BaseResultMap">
		SELECT phone_number,real_name FROM brush_subscriber_user WHERE phone_number LIKE '%${introUser}%' or real_name like '%${introUser}%'
	</select>


</mapper>
